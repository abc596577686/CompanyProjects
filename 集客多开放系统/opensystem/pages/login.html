<!DOCTYPE html>
<html lang="zh-CN">
	<head>
	
		<meta charset="UTF-8">
		<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
		<meta http-equiv="X-UA-Compatible" content="IE=11;IE=10;IE=9;IE=8;IE=edge,chrome=1">
		<meta http-equiv="Cache-Control" content="no-siteapp">
		<meta name="keywords" content="">
		<meta name="description" content="">
		<title>登录</title>
		<link rel="icon" href="../img/titleLogo.png" type="image/x-icon"/>
		<link href="../css/main.css" rel="stylesheet" />
		<link href="../css/bootstrap.css" rel="stylesheet" />
		<link href="../css/login.css" rel="stylesheet" />
		<script src="js/util.js"></script>

	</head>
	<body>
		<div class="containers">
		  	<div class="top">
  				<img src="../icon/yz.png" class="top_log"  id="logoImage"/>
  				<img src="../icon/txtyz.png" class="top_txt" />
  				
  				<span class="top_span" style="top: 16px;">登录</span>
  				<div class="top_zc" id="top_register">
					免费注册，轻松开店
  				</div>
  			</div>
  			<div class="content">
  				<ul>
  					<li>
  						<span class="c_span">手机号码</span>
  						<select>
						  <option value ="86">+86</option>
						  <option value ="87">+87</option>
						</select>
						<input type="text" placeholder="请输入你的手机号码"  id="phone" class="phone_ipt c_ipt"/>
  					</li>
  					<li>
  						<span class="c_span">登录密码</span>
  						<input type="password" placeholder="请输入密码"  id="password"  class="c_ipt"/>
  					</li>
  					<li>
                        <span class="c_span">验证码</span>
					    <input id="code" type="text" placeholder="请输入验证码" id="code"  class="c_ipt yzm_ipt"/>
					    <img id="yzm_img" class="yzm_img"  align="bottom" onclick="onclickSrc()"/>
  					</li>
  				</ul>
  				<div class="dl">
  					<input id="autoLogin" type="checkbox" name="checkbox1" value="checkbox"> 七天内自动登录
  					<span><a href="forgetPwd.html">忘记密码？</a></span>
  				</div>
  				<div class="fot_btn">
				    <button id="submitBtn">登录</button>
  				</div>
  			</div>
  			<div class="foot">
  				<span>©</span>上海御馔网络科技有限公司
  			</div>
		</div>
	</body>
	<script src="../js/jquery.min.js" type="text/javascript"></script>
	<script type="application/javascript" src="../js/util.js"></script>
	<script>
        $("#logoImage").click(function(){
            //点击图片后发送跳转到指定页面的事件。
            window.location.href="index.html";
        });
		window.onload=src;
		var  uu = '';
		var  url = util.baseURL + "/user/getValidateCode.do?height=25&width=65&size=20&proving="
		$(document).ready(function() {
			
			  var  sessionid = commFun.getData("open_session_id");
	            if(sessionid && !sessionid== ''){
	                window.location.href="openstytem/openHome.html";
	                return;
				}
	            
	            
			$("#submitBtn").click(function(e) {
				e.preventDefault();
				var phone = $("#phone").val();
				if (!phone || phone =="" ){
	                $.openTxt.info("电话号码不可以为空",1000);
	                return false;
	            }
				var passwd = $("#password").val();
				if (!passwd || passwd =="" ){
	                $.openTxt.info("密码不可以为空",1000);
	                return false;
	            }
				var code = $("#code").val();
				if (!code || code =="" ){
	                $.openTxt.info("验证码不可以为空",1000);
	                return false;
	            }
				var data =JSON.stringify({'phone':phone,'password':passwd,'code':code,'proving':uu});
				sendAjax.post(util.baseURL + "user/login",data,function(msg){

					// console.log(commFun.saveData)
					// console.log(commFun.setCookie)
					// console.log(msg.open_session_id)
					// console.log(msg.userDto)

					// commFun.saveData("open_session_id",msg.open_session_id);
					// commFun.saveData("userData",JSON.stringify(msg.userDto));
					
					if(msg.retCode=="1"){//登入成功
                        commFun.saveData("open_session_id",msg.open_session_id)
                        commFun.saveData("userData",JSON.stringify(msg.userDto));
						window.location.href="openstytem/openHome.html";
					}else{
						$.openTxt.info(msg.msg);
						onclickSrc();
					}
				});
				return false;
			})

			$("#top_register").click(function () {
				window.location.href ="register.html";
			});
		});

		function uuid(){
			if(uu== ''){
				var s = [];
				var hexDigits = "0123456789abcdef";
				for (var i = 0; i < 36; i++) {
					s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
				}
				s[14] = "4";
				s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);

				s[8] = s[13] = s[18] = s[23] = "-";

				uu = s.join("");
			}
		}
		function src(){
			
			uuid();
			document.getElementById("yzm_img").src = url + uu;

		}
		function onclickSrc(){
			document.getElementById("yzm_img").src = url + uu +'&sda=' + Math.random();
		}
	</script>
</html>
