<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>新人有礼</title>
    <link rel="stylesheet" href="./css/inDownload.css">
    <script src="https://res.wx.qq.com/open/js/jweixin-1.3.2.js"></script>
    <script>
        //1.获取像素比
        var pixelRatio=1/window.devicePixelRatio;
        // console.log(pixelRatio);
        //2.通过js动态来设置视口
        document.write('<meta name="viewport" content="width=device-width,initial-scale='+pixelRatio+',minimum-scale='+pixelRatio*2+',maximum-scale='+pixelRatio+'">');
        //3.获取html节点
        var html=document.getElementsByTagName('html')[0];
        //console.log(html)
        //4.获取屏幕宽度
        var pageWidth=html.getBoundingClientRect().width;
        // console.log(pageWidth);
        //屏幕宽度/固定数值=基准值;
        html.style.fontSize=pageWidth/15+'px';
    </script>
    <style>
        body {
			text-align: center;
			background-color: #fff;
        }
        .storename {
            font-size: .768rem;
            margin-top: 0.4rem;
            color: #999;
            text-align: center;
        }
        /* .bottom_download a {
            border-radius: .213333rem;
            width: 86%;
            height: 1.7rem;
            display: block;
            font-size: .853333rem;
            text-align: center;
            line-height:  1.7rem;
            color: #fff;
            text-decoration: none;
            background-color: #FB4A4C;
            margin-left: 7%;
        } */
    </style>
</head>

<body>
    <div class="pageim isShow">
		<div class="headimg">
			<img src="./img/topti.png">
		</div>
		<div class="toptxt">
			集客多健身从业者的选择
		</div>
		<div class="goimg">
			<img src="./img/iiko.png">
		</div>
		<div class="already">
			您已经是集客多会员啦~
		</div>

        <div class="bottom_download">
            <a href="http://a.app.qq.com/o/simple.jsp?pkgname=com.webapp.jkd">进入集客多</a>
        </div>
    </div>

</body>
<script src="/base/share/js/jquery-2.1.4.min.js" type="text/javascript"></script>
<script type="text/javascript">
$(function(){
		var storeId = getUrlPara("s");
		
		// var storeId = getUrlPara("b");
		// var storeIdKey = getUrlPara("b");
		// var type = getUrlPara("c");
		// var isF = getUrlPara("d");

		console.log(storeId)
		$.post("/clt/wap/ckeckIsAgent.msp", {
			storeId: storeId,
			type: 1
		}, function(data) {
			if(data.code == '1'){
				if(data.type == '1'){
					//已经是卖家
					if(data.isShareUser == true){ //自己
						window.location.href = "register.html?s=" + data.storeId;
					}else{
						// $("#useless").css({"display": "block"});
						init();
						$('.isShow').show()
					}
	            }else if(data.type == '2'){
					//店长邀请页面
					window.location.replace("register.html?s=" + data.storeId)
				}else if(data.type == '3'){
					//代理商邀请页面
					window.location.replace( "officialshow.html?productId=" + data.inviteGiftId+"&storeId=" + storeIdKey)
				}else if(data.type == '4'){
					//名额已满
					window.location.replace("inFullQuota.html?s=" + data.storeId)
				}else if(data.type == '5'){
					//邀请代理商界面过期
					window.location.replace("pageDueError.html?s=" + data.storeId)
				}else if(data.type == '6'){
					//已经是买家 不能领取红包
					window.location.replace("notuse.html?s=" + data.storeId)
				}else{
					init();
					$('.isShow').show()
				}
			}else{
				$("#useless").css({"display": "block"});
			}
		}, "json");
	})
	
	    var countdown = 60;
        var code = 1;
        var storeId = getUrlPara("s");
        var isOpen=true;
		var storeLogo = '';
        var storeName = '';
        function init(){
        	$.post("/clt/wap/getStoreInfo.msp", {
				storeId: storeId
            },function(data) {
               	if (data.code == '1' || data.code == '-10') {
                    if(data.shopName !=''){
                    	storeName = data.shopName
                    }
                    if(data.logo !=''){
                    	storeLogo = data.logo
                    }
                                    
					var link = location.href.split('#')[0];
					var title =  storeName+'邀请你加入集客多';
					var imgUrl = storeLogo;
					var desc = '听说打开这条链接的人都赚了大钱';
					$.post("/clt/weixin/getToken.msp", {url: link}, function(res) {
						wx.config({
							debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
							appId: res.appId, // 必填，公众号的唯一标识
							timestamp: res.timestamp, // 必填，生成签名的时间戳
							nonceStr: res.nonceStr, // 必填，生成签名的随机串
							signature: res.signature, // 必填，签名，见附录1
							jsApiList: [
								'onMenuShareAppMessage', // 获取“分享给朋友”按钮点击状态及自定义分享内容接口
								'onMenuShareTimeline' // 获取“分享到朋友圈”按钮点击状态及自定义分享内容接口
							] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
						});

						wx.ready(function () {
							wx.onMenuShareTimeline({
								title: title, // 分享标题
								link: link, // 分享链接
								imgUrl: imgUrl, // 分享图标
								success() {
									console.log('分享成功')
								},
								cancel() {
									//console.log('分享11成功')
									// 用户取消分享后执行的回调函数
								}
							})
							
							// 分享给朋友
							wx.onMenuShareAppMessage({
								title: title, // 分享标题
								desc: desc, // 分享描述
								link: link, // 分享链接
								imgUrl: imgUrl, // 分享图标
								success: function() {
									console.log('分享成功')
								},
								cancel: function() {
									//console.log('分享111成功')
									// 用户取消分享后执行的回调函数
								}
							})
						});
					})
				}else{
					//邀请代理商界面过期
					window.location.href = "pageDueError.html?s=" + storeId;
				} 
            }, "json");
        }
        

	 //获取URL上参数
	 function getUrlPara(paraName) {
	     var reg = new RegExp("(^|&)" + paraName + "=([^&]*)(&|$)", "i");
	     var r = window.location.search.substr(1).match(reg);
	     if (r != null) return unescape(r[2]);
	     return null;
	 }
</script>
<style>
    .isShow{
        display: none;
    }
</style>
</html>